name: _markdown-lint
on:
  workflow_call: {}

permissions:
  contents: read

jobs:
  markdownlint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout target repo
        uses: actions/checkout@v4

      - name: Ensure markdownlint config (use org default if missing)
        run: |
          set -euo pipefail
          if [ ! -f .markdownlint.jsonc ]; then
            echo "No local .markdownlint.jsonc; fetching org default..."
            curl -fsSL \
              https://raw.githubusercontent.com/kleffio/.github/main/configs/.markdownlint.jsonc \
              -o .markdownlint.jsonc
          fi
          test -s .markdownlint.jsonc
          echo "Using config:"
          head -n 5 .markdownlint.jsonc || true

      - name: Run Markdownlint
        uses: DavidAnson/markdownlint-cli2-action@v17
        with:
          config: .markdownlint.jsonc
          globs: |
            **/*.md
            !.git/**
