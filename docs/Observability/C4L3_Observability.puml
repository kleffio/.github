@startuml Kleff Hosting - C4 Level 3 Observability Final
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

LAYOUT_WITH_LEGEND()

Container(spa, "Dashboard UI", "React", "Visualizes data using MetricCard and Logs components")

Container_Boundary(obs_service, "Observability Service") {
    Component(metrics_handler, "Metrics Handler", "Go/Gin", "Entry point for /api/metrics/*")
    Component(logs_handler, "Logs Handler", "Go/Gin", "Entry point for /api/logs/*")
    
    Component(metrics_service, "metricsService", "Core Application", "Orchestrates service-level logic")
    Component(logs_service, "logsService", "Core Application", "Orchestrates log aggregation")

    Component(prom_adapter, "prometheusClient", "Go/HTTP", "Orchestrates parallel fetching via WaitGroups\nHandles 10s TLS timeouts and PromQL mapping")
    Component(loki_adapter, "lokiClient", "Go/HTTP", "Handles LogQL queries and stream aggregation")
}

System_Ext(prom, "Prometheus (K3s)", "Cluster Metrics Store")
System_Ext(loki, "Loki (K3s)", "Cluster Logs Store")

Rel(spa, metrics_handler, "Fetches metrics", "HTTPS/JSON")
Rel(spa, logs_handler, "Fetches logs", "HTTPS/JSON")

Rel(metrics_handler, metrics_service, "Calls")
Rel(logs_handler, logs_service, "Calls")

Rel(metrics_service, prom_adapter, "Uses", "MetricsRepository Port")
Rel(logs_service, loki_adapter, "Uses", "LogsRepository Port")

Rel(prom_adapter, prom, "Query Range / Instant", "HTTP/PromQL")
Rel(loki_adapter, loki, "Query Range", "HTTP/LogQL")
@enduml
