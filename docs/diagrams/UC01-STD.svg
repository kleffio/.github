<?plantuml 1.2026.2?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="STATE" height="1589px" preserveAspectRatio="none" style="width:1621px;height:1589px;background:#FFFFFF;" version="1.1" viewBox="0 0 1621 1589" width="1621px" zoomAndPan="magnify"><title>UC-01: Register Account &#8212; State Transition Diagram
(User Account Lifecycle)</title><defs/><g><g class="title" data-source-line="1"><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="415.29" x="592.7271" y="22.9951">UC-01: Register Account &#8212; State Transition Diagram</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="191.6455" x="704.5493" y="39.292">(User Account Lifecycle)</text></g><!--cluster AccountCreation--><g class="cluster" data-qualified-name="AccountCreation" data-source-line="41" id="ent0012"><path d="M19.5,854.5938 L235.5,854.5938 A12.5,12.5 0 0 1 248,867.0938 L248,875.8906 L7,875.8906 L7,867.0938 A12.5,12.5 0 0 1 19.5,854.5938" fill="#FAFAFA"/><rect fill="none" height="352.5" rx="12.5" ry="12.5" style="stroke:#455A64;stroke-width:0.5;" width="241" x="7" y="854.5938"/><line style="stroke:#455A64;stroke-width:0.5;" x1="7" x2="248" y1="875.8906" y2="875.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116.3135" x="69.3433" y="871.5889">AccountCreation</text></g><g class="entity" data-qualified-name="AccountCreation.TokenExchange" id="ent0013"><rect fill="#FAFAFA" height="50" rx="12.5" ry="12.5" style="stroke:#455A64;stroke-width:0.5;" width="135.8145" x="50" y="897.5938"/><line style="stroke:#455A64;stroke-width:0.5;" x1="50" x2="185.8145" y1="923.8906" y2="923.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115.8145" x="60" y="915.5889">Token Exchange</text></g><g class="entity" data-qualified-name="AccountCreation.Provisioning" id="ent0014"><rect fill="#FAFAFA" height="50" rx="12.5" ry="12.5" style="stroke:#455A64;stroke-width:0.5;" width="141.5703" x="31" y="1133.0938"/><line style="stroke:#455A64;stroke-width:0.5;" x1="31" x2="172.5703" y1="1159.3906" y2="1159.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="121.5703" x="41" y="1151.0889">User Provisioning</text></g><path d="M683,156.5938 L779.2607,156.5938 A12.5,12.5 0 0 1 791.7607,169.0938 L791.7607,182.8906 L670.5,182.8906 L670.5,169.0938 A12.5,12.5 0 0 1 683,156.5938" fill="#FAFAFA"/><rect fill="none" height="98.2969" rx="12.5" ry="12.5" style="stroke:#455A64;stroke-width:0.5;" width="121.2607" x="670.5" y="156.5938"/><line style="stroke:#455A64;stroke-width:0.5;" x1="670.5" x2="791.7607" y1="182.8906" y2="182.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.918" x="685.6714" y="174.5889">Unregistered</text><g class="entity" data-qualified-name="Unregistered.NoAccount" id="ent0003"><rect fill="#FAFAFA" height="50" rx="12.5" ry="12.5" style="stroke:#455A64;stroke-width:0.5;" width="100.2607" x="682.5" y="194.8906"/><line style="stroke:#455A64;stroke-width:0.5;" x1="682.5" x2="782.7607" y1="221.1875" y2="221.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.2607" x="692.5" y="212.8857">No Account</text></g><path d="M544,346.5938 L917.5776,346.5938 A12.5,12.5 0 0 1 930.0776,359.0938 L930.0776,372.8906 L531.5,372.8906 L531.5,359.0938 A12.5,12.5 0 0 1 544,346.5938" fill="#FAFAFA"/><rect fill="none" height="422.2969" rx="12.5" ry="12.5" style="stroke:#455A64;stroke-width:0.5;" width="398.5776" x="531.5" y="346.5938"/><line style="stroke:#455A64;stroke-width:0.5;" x1="531.5" x2="930.0776" y1="372.8906" y2="372.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="158.6621" x="651.4578" y="364.5889">RegistrationInProgress</text><g class="entity" data-qualified-name="RegistrationInProgress.RedirectedToAuth" id="ent0005"><rect fill="#FAFAFA" height="50" rx="12.5" ry="12.5" style="stroke:#455A64;stroke-width:0.5;" width="186.9131" x="552" y="384.8906"/><line style="stroke:#455A64;stroke-width:0.5;" x1="552" x2="738.9131" y1="411.1875" y2="411.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="166.9131" x="562" y="402.8857">Redirected to Authentik</text></g><g class="entity" data-qualified-name="RegistrationInProgress.FillingForm" id="ent0006"><rect fill="#FAFAFA" height="50" rx="12.5" ry="12.5" style="stroke:#455A64;stroke-width:0.5;" width="191.3359" x="550" y="487.8906"/><line style="stroke:#455A64;stroke-width:0.5;" x1="550" x2="741.3359" y1="514.1875" y2="514.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="171.3359" x="560" y="505.8857">Filling Registration Form</text></g><g class="entity" data-qualified-name="RegistrationInProgress.EmailPending" id="ent0007"><rect fill="#FAFAFA" height="50" rx="12.5" ry="12.5" style="stroke:#455A64;stroke-width:0.5;" width="203.9551" x="543.5" y="605.8906"/><line style="stroke:#455A64;stroke-width:0.5;" x1="543.5" x2="747.4551" y1="632.1875" y2="632.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="183.9551" x="553.5" y="623.8857">Email Verification Pending</text></g><g class="entity" data-qualified-name="RegistrationInProgress.EmailVerified" id="ent0008"><rect fill="#FAFAFA" height="50" rx="12.5" ry="12.5" style="stroke:#455A64;stroke-width:0.5;" width="117.4463" x="587" y="708.8906"/><line style="stroke:#455A64;stroke-width:0.5;" x1="587" x2="704.4463" y1="735.1875" y2="735.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97.4463" x="597" y="726.8857">Email Verified</text></g><!--link RedirectedToAuth to FillingForm--><g class="link" data-entity-1="ent0005" data-entity-2="ent0006" data-link-type="dependency" data-source-line="23" id="lnk5"><path d="M645.5,435.0806 C645.5,450.9606 645.5,465.6406 645.5,481.5506" fill="none" id="RedirectedToAuth-to-FillingForm" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="645.5,487.5506,649.5,478.5506,645.5,482.5506,641.5,478.5506,645.5,487.5506" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158.2217" x="646.5" y="465.9575">Authentik presents form</text></g><!--link FillingForm to EmailPending--><g class="link" data-entity-1="ent0006" data-entity-2="ent0007" data-link-type="dependency" data-source-line="24" id="lnk6"><path d="M645.5,537.9306 C645.5,557.8306 645.5,579.9906 645.5,599.8906" fill="none" id="FillingForm-to-EmailPending" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="645.5,605.8906,649.5,596.8906,645.5,600.8906,641.5,596.8906,645.5,605.8906" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86.6772" x="657.5132" y="568.9575">submits valid</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108.7036" x="646.5" y="584.0903">registration data</text></g><!--link FillingForm to FillingForm--><g class="link" data-entity-1="ent0006" data-entity-2="ent0006" data-link-type="dependency" data-source-line="25" id="lnk7"><path d="M741.14,504.9506 C751.98,506.4306 759,509.0806 759,512.8906 C759,516.7006 757.9248,518.539 747.0848,520.019" fill="none" id="FillingForm-to-FillingForm" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="741.14,520.8306,750.5984,523.5764,746.094,520.1542,749.5162,515.6499,741.14,520.8306" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.1216" x="789.978" y="509.9575">validation error</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150.0776" x="765" y="525.0903">(retry with corrections)</text></g><!--link EmailPending to EmailVerified--><g class="link" data-entity-1="ent0007" data-entity-2="ent0008" data-link-type="dependency" data-source-line="26" id="lnk8"><path d="M645.5,656.0806 C645.5,671.9606 645.5,686.6406 645.5,702.5506" fill="none" id="EmailPending-to-EmailVerified" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="645.5,708.5506,649.5,699.5506,645.5,703.5506,641.5,699.5506,645.5,708.5506" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139.9277" x="646.5" y="686.9575">clicks verification link</text></g><!--link EmailPending to EmailPending--><g class="link" data-entity-1="ent0007" data-entity-2="ent0007" data-link-type="dependency" data-source-line="27" id="lnk9"><path d="M747.92,623.1206 C758.63,624.6406 765.5,627.2306 765.5,630.8906 C765.5,634.5506 764.5705,636.2975 753.8605,637.8175" fill="none" id="EmailPending-to-EmailPending" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="747.92,638.6606,757.3928,641.3563,752.8704,637.958,756.2686,633.4357,747.92,638.6606" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121.5894" x="771.5" y="635.4575">resend verification</text></g><path d="M1227,1071.5938 L1595.2441,1071.5938 A12.5,12.5 0 0 1 1607.7441,1084.0938 L1607.7441,1097.8906 L1214.5,1097.8906 L1214.5,1084.0938 A12.5,12.5 0 0 1 1227,1071.5938" fill="#FAFAFA"/><rect fill="none" height="173.2969" rx="12.5" ry="12.5" style="stroke:#455A64;stroke-width:0.5;" width="393.2441" x="1214.5" y="1071.5938"/><line style="stroke:#455A64;stroke-width:0.5;" x1="1214.5" x2="1607.7441" y1="1097.8906" y2="1097.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126.9639" x="1347.6401" y="1089.5889">RegistrationFailed</text><g class="entity" data-qualified-name="RegistrationFailed.AuthError" id="ent0010"><rect fill="#FAFAFA" height="50" rx="12.5" ry="12.5" style="stroke:#455A64;stroke-width:0.5;" width="165.4961" x="1226.5" y="1109.8906"/><line style="stroke:#455A64;stroke-width:0.5;" x1="1226.5" x2="1391.9961" y1="1136.1875" y2="1136.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="145.4961" x="1236.5" y="1127.8857">Auth Error Displayed</text></g><g class="entity" data-qualified-name="RegistrationFailed.Abandoned" id="ent0011"><rect fill="#FAFAFA" height="50" rx="12.5" ry="12.5" style="stroke:#455A64;stroke-width:0.5;" width="189.2441" x="1409.5" y="1109.8906"/><line style="stroke:#455A64;stroke-width:0.5;" x1="1409.5" x2="1598.7441" y1="1136.1875" y2="1136.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="169.2441" x="1419.5" y="1127.8857">Registration Abandoned</text></g><g class="end_entity" data-qualified-name="RegistrationFailed..end.RegistrationFailed" data-source-line="36" id="ent0011"><ellipse cx="1309" cy="1223.8906" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1;"/><ellipse cx="1309" cy="1223.8906" fill="#222222" rx="6" ry="6" style="stroke:#222222;stroke-width:1;"/></g><!--link AuthError to *end*RegistrationFailed--><g class="link" data-entity-1="ent0010" data-entity-2="ent0011" data-link-type="dependency" data-source-line="36" id="lnk12"><path d="M1309,1160.1206 C1309,1177.4206 1309,1193.8106 1309,1206.6406" fill="none" id="AuthError-to-*end*RegistrationFailed" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1309,1212.6406,1313,1203.6406,1309,1207.6406,1305,1203.6406,1309,1212.6406" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134.4751" x="1310" y="1190.9575">user navigates away</text></g><path d="M284.5,1057.5938 L589.3136,1057.5938 A12.5,12.5 0 0 1 601.8136,1070.0938 L601.8136,1083.8906 L272,1083.8906 L272,1070.0938 A12.5,12.5 0 0 1 284.5,1057.5938" fill="#FAFAFA"/><rect fill="none" height="201.2969" rx="12.5" ry="12.5" style="stroke:#455A64;stroke-width:0.5;" width="329.8136" x="272" y="1057.5938"/><line style="stroke:#455A64;stroke-width:0.5;" x1="272" x2="601.8136" y1="1083.8906" y2="1083.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43.5518" x="415.1309" y="1075.5889">Active</text><g class="entity" data-qualified-name="Active.Authenticated" id="ent0016"><rect fill="#FAFAFA" height="50" rx="12.5" ry="12.5" style="stroke:#455A64;stroke-width:0.5;" width="118.9434" x="352.15" y="1095.8906"/><line style="stroke:#455A64;stroke-width:0.5;" x1="352.15" x2="471.0934" y1="1122.1875" y2="1122.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98.9434" x="362.15" y="1113.8857">Authenticated</text></g><g class="entity" data-qualified-name="Active.ProfileUpdated" id="ent0017"><rect fill="#FAFAFA" height="50" rx="12.5" ry="12.5" style="stroke:#455A64;stroke-width:0.5;" width="128.124" x="347.65" y="1198.8906"/><line style="stroke:#455A64;stroke-width:0.5;" x1="347.65" x2="475.774" y1="1225.1875" y2="1225.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108.124" x="357.65" y="1216.8857">Profile Updated</text></g><!--link Authenticated to ProfileUpdated--><g class="link" data-entity-1="ent0016" data-entity-2="ent0017" data-link-type="dependency" data-source-line="55" id="lnk17"><path d="M351.92,1130.3006 C331.94,1136.2806 311.71,1146.4806 299.65,1163.8906 C283,1187.9106 308.0793,1201.3669 341.5893,1210.2269" fill="none" id="Authenticated-to-ProfileUpdated" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="347.39,1211.7606,339.7115,1205.593,342.5561,1210.4825,337.6665,1213.3272,347.39,1211.7606" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202.4902" x="300.65" y="1176.9575">PATCH /api/v1/users/me/profile</text></g><!--link ProfileUpdated to Authenticated--><g class="link" data-entity-1="ent0017" data-entity-2="ent0016" data-link-type="dependency" data-source-line="56" id="lnk18"><path d="M475.66,1205.4906 C498.23,1195.9006 515.39,1182.1706 503.65,1163.8906 C496.05,1152.0706 489.6185,1146.159 476.9385,1140.009" fill="none" id="ProfileUpdated-to-Authenticated" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="471.54,1137.3906,477.8922,1144.9172,476.0388,1139.5726,481.3834,1137.7192,471.54,1137.3906" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84.1636" x="507.65" y="1176.9575">profile saved</text></g><path d="M504,1350.5938 L923.6958,1350.5938 A12.5,12.5 0 0 1 936.1958,1363.0938 L936.1958,1376.8906 L491.5,1376.8906 L491.5,1363.0938 A12.5,12.5 0 0 1 504,1350.5938" fill="#FAFAFA"/><rect fill="none" height="118.8281" rx="12.5" ry="12.5" style="stroke:#455A64;stroke-width:0.5;" width="444.6958" x="491.5" y="1350.5938"/><line style="stroke:#455A64;stroke-width:0.5;" x1="491.5" x2="936.1958" y1="1376.8906" y2="1376.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84.9023" x="671.3967" y="1368.5889">Deactivated</text><g class="entity" data-qualified-name="Deactivated.AcctDeactivated" id="ent0019"><rect fill="#FAFAFA" height="50" rx="12.5" ry="12.5" style="stroke:#455A64;stroke-width:0.5;" width="166.125" x="503.5" y="1398.3906"/><line style="stroke:#455A64;stroke-width:0.5;" x1="503.5" x2="669.625" y1="1424.6875" y2="1424.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146.125" x="513.5" y="1416.3857">Account Deactivated</text></g><g class="entity" data-qualified-name="Deactivated.GMN2" data-source-line="64" id="ent0003"><path d="M687.5,1387.8906 L687.5,1419.3906 L669.81,1423.3906 L687.5,1427.3906 L687.5,1458.4219 A0,0 0 0 0 687.5,1458.4219 L927.1958,1458.4219 A0,0 0 0 0 927.1958,1458.4219 L927.1958,1397.8906 L917.1958,1387.8906 L687.5,1387.8906 A0,0 0 0 0 687.5,1387.8906" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M917.1958,1387.8906 L917.1958,1397.8906 L927.1958,1397.8906 L917.1958,1387.8906" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143.8823" x="693.5" y="1404.9575">- isDeactivated = true</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.4106" x="693.5" y="1420.0903">- deactivatedAt is set</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.2363" x="693.5" y="1435.2231">- Login returns 403</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218.6958" x="693.5" y="1450.356">- Redirected to /error/deactivated</text></g><g class="start_entity" data-qualified-name=".start." data-source-line="9" id="ent0002"><ellipse cx="731" cy="69.5938" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1;"/></g><g class="end_entity" data-qualified-name=".end." data-source-line="73" id="ent0021"><ellipse cx="714" cy="1572.5938" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1;"/><ellipse cx="714" cy="1572.5938" fill="#222222" rx="6" ry="6" style="stroke:#222222;stroke-width:1;"/></g><g class="entity" data-qualified-name="GMN5" data-source-line="76" id="ent0006"><path d="M637,1122.5938 L637,1154.0938 L602.32,1158.0938 L637,1162.0938 L637,1193.125 A0,0 0 0 0 637,1193.125 L921.377,1193.125 A0,0 0 0 0 921.377,1193.125 L921.377,1132.5938 L911.377,1122.5938 L637,1122.5938 A0,0 0 0 0 637,1122.5938" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M911.377,1122.5938 L911.377,1132.5938 L921.377,1132.5938 L911.377,1122.5938" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164.3281" x="643" y="1139.6606">User invariants enforced:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219.978" x="643" y="1154.7935">- Email: unique, from OIDC claims</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="263.377" x="643" y="1169.9263">- Username: ^[a-z0-9_-]{2,63}$, unique</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193.2417" x="643" y="1185.0591">- Platform role: auto-assigned</text></g><g class="entity" data-qualified-name="GMN8" data-source-line="83" id="ent0009"><path d="M275,879.5938 L275,965.2578 L545.4248,965.2578 L545.4248,889.5938 L535.4248,879.5938 L275,879.5938" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M535.4248,879.5938 L535.4248,889.5938 L545.4248,889.5938 L535.4248,879.5938" fill="#FEFFDD" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200.8843" x="281" y="896.6606">EnsureUserFromToken checks:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175.1001" x="281" y="911.7935">1. GetByID (existing user?)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249.4248" x="281" y="926.9263">2. IsUserDeleted (previously deleted?)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="216.2837" x="281" y="942.0591">3. GetByEmail (email migration?)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="215.0586" x="281" y="957.1919">4. Create new User if none found</text></g><!--link *start* to Unregistered--><g class="link" data-entity-1="ent0002" data-entity-2="ent0002" data-link-type="dependency" data-source-line="9" id="lnk3"><path d="M731,79.8038 C731,95.4738 731,122.3537 731,150.4237" fill="none" id="*start*-to-Unregistered" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="731,156.4237,735,147.4237,731,151.4237,727,147.4237,731,156.4237" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128.7305" x="732" y="122.6606">User discovers Kleff</text></g><!--link Unregistered to RegistrationInProgress--><g class="link" data-entity-1="ent0002" data-entity-2="ent0004" data-link-type="dependency" data-source-line="15" id="lnk4"><path d="M731,254.8937 C731,279.8338 731,306.1737 731,340.3937" fill="none" id="Unregistered-to-RegistrationInProgress" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="731,346.3937,735,337.3937,731,341.3937,727,337.3937,731,346.3937" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102.1655" x="733.2664" y="297.6606">clicks "Sign Up"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104.6982" x="732" y="312.7935">or "Get Started"</text></g><!--link RegistrationInProgress to RegistrationFailed--><g class="link" data-entity-1="ent0004" data-entity-2="ent0009" data-link-type="dependency" data-source-line="30" id="lnk10"><path d="M930.89,734.5238 C1057.05,845.5738 1209.916,980.1097 1309.346,1067.6197" fill="none" id="RegistrationInProgress-to-RegistrationFailed" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1313.85,1071.5838,1309.7367,1062.635,1310.0966,1068.2804,1304.4513,1068.6403,1313.85,1071.5838" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126.6357" x="1194" y="919.6606">OIDC callback error</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90.5493" x="1212.0432" y="934.7935">or abandoned</text></g><!--link RegistrationInProgress to AccountCreation--><g class="link" data-entity-1="ent0004" data-entity-2="ent0012" data-link-type="dependency" data-source-line="39" id="lnk13"><path d="M531.48,631.9438 C434.92,677.2738 325.55,744.9538 258,838.5938 C255.3263,842.3013 253.0361,846.328 251.0758,850.5422 C250.0957,852.6494 249.1981,854.8034 248.3762,856.9878 C248.2734,857.2609 250.236,851.9006 250.1357,852.1746" fill="none" id="RegistrationInProgress-to-AccountCreation" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="248.0715,857.8084,254.9236,850.7338,249.7916,853.1136,247.4119,847.9816,248.0715,857.8084" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.501" x="309.2229" y="811.6606">OIDC callback success</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191.9468" x="286" y="826.7935">(authorization code received)</text></g><!--link TokenExchange to Provisioning--><g class="link" data-entity-1="ent0013" data-entity-2="ent0014" data-link-type="dependency" data-source-line="45" id="lnk14"><path d="M93.49,947.9038 C82.17,960.8738 69.93,977.8038 64,995.5938 C48.11,1043.2737 68.7809,1095.6658 85.3109,1127.5858" fill="none" id="TokenExchange-to-Provisioning" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="88.07,1132.9138,87.4833,1123.0824,85.7707,1128.4738,80.3793,1126.7612,88.07,1132.9138" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.624" x="65" y="1016.1606">access_token obtained</text></g><!--link TokenExchange to RegistrationFailed--><g class="link" data-entity-1="ent0013" data-entity-2="ent0009" data-link-type="dependency" data-source-line="46" id="lnk15"><path d="M154.12,947.6938 C173.56,961.1438 197.66,978.5638 218,995.5938 C233.66,1008.7038 232.19,1019.6138 251,1027.5938 C346.8,1068.2138 1085.57,1034.3738 1187,1057.5938 C1202.97,1061.2537 1213.5269,1064.1003 1229.5869,1069.6303" fill="none" id="TokenExchange-to-RegistrationFailed" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="1235.26,1071.5838,1228.0526,1064.8715,1230.5324,1069.9559,1225.4481,1072.4357,1235.26,1071.5838" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135.1543" x="252" y="1016.1606">token exchange fails</text></g><!--link AccountCreation to Active--><g class="link" data-entity-1="ent0012" data-entity-2="ent0015" data-link-type="dependency" data-source-line="49" id="lnk16"><path d="M248.0497,952.5556 C248.0848,952.625 248.1202,952.6944 248.1556,952.7637 C248.2266,952.9022 248.2981,953.0405 248.3702,953.1786 C248.5145,953.4547 248.6612,953.7298 248.8103,954.0038 C251.1962,958.3863 254.2075,962.4638 258,965.5938 C306.41,1005.5438 350.86,951.9838 396,995.5938 C413.06,1012.0738 421.8435,1028.7692 428.0135,1051.7392" fill="none" id="AccountCreation-to-Active" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="429.57,1057.5338,431.0983,1047.8042,428.2729,1052.7049,423.3722,1049.8795,429.57,1057.5338" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147.5386" x="417" y="1008.6606">EnsureUserFromToken</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128.2607" x="426.6389" y="1023.7935">creates User record</text></g><!--link Active to Deactivated--><g class="link" data-entity-1="ent0015" data-entity-2="ent0018" data-link-type="dependency" data-source-line="59" id="lnk19"><path d="M547.27,1258.6138 C581.82,1289.8038 614.3656,1319.174 644.7056,1346.554" fill="none" id="Active-to-Deactivated" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="649.16,1350.5738,645.1583,1341.5745,645.448,1347.2239,639.7986,1347.5136,649.16,1350.5738" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236.2788" x="609" y="1301.6606">DELETE /api/v1/users/me/deactivate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79.6313" x="687.3237" y="1316.7935">(soft delete)</text></g><!--link AccountCreation to Deactivated--><g class="link" data-entity-1="ent0012" data-entity-2="ent0018" data-link-type="dependency" data-source-line="71" id="lnk20"><path d="M248.053,953.5835 C248.1992,953.8572 248.3481,954.1296 248.4995,954.4005 C250.9231,958.735 254.0275,962.6938 258,965.5938 C314.8,1007.0438 503.29,986.3838 573,995.5938 C736.56,1017.2038 832.53,931.5638 939,1057.5938 C996.65,1125.8338 979.48,1178.9638 939,1258.5938 C919.35,1297.2438 889.7207,1324.3662 853.3607,1347.3662" fill="none" id="AccountCreation-to-Deactivated" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="848.29,1350.5738,858.0344,1349.1429,852.5156,1347.9008,853.7577,1342.382,848.29,1350.5738" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147.5386" x="996.5254" y="1147.6606">EnsureUserFromToken</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119.666" x="1010.4617" y="1162.7935">detects previously</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186.5894" x="977" y="1177.9263">deactivated/deleted account</text></g><!--link Deactivated to *end*--><g class="link" data-entity-1="ent0018" data-entity-2="ent0021" data-link-type="dependency" data-source-line="73" id="lnk22"><path d="M714,1469.9438 C714,1503.9438 714,1537.4638 714,1555.5838" fill="none" id="Deactivated-to-*end*" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="714,1561.5838,718,1552.5838,714,1556.5838,710,1552.5838,714,1561.5838" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71.7983" x="742.7869" y="1512.6606">permanent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127.3721" x="715" y="1527.7935">(cannot re-register)</text></g><!--link GMN8 to AccountCreation--><g class="link" data-entity-1="ent0009" data-entity-2="ent0012" data-link-type="association" data-source-line="83" id="lnk10"><path d="M274.73,922.5938 C269.05,922.5938 263.3725,922.5938 257.695,922.5938 C254.8563,922.5938 252.0175,922.5938 249.1784,922.5938 C248.8236,922.5938 248.4687,922.5938 248.1138,922.5938" fill="none" id="GMN8-AccountCreation" style="stroke:#181818;stroke-width:1;stroke-dasharray:7,7;"/></g><?plantuml-src XLRRRXit47tNLmpKFjY5PTcn4w02saBHfJLgf8PZzoLE0vgSNHDQaGf9oL620Fc8V66_f3DShfQIPHHvS3GyPovdXiCDEbG8jwFUoUa0hh7KFg23ePHsQGBy--qxl0qY8DmuORmEsXeOQr4wCRyp1xS-mrxg0kLQLdZOwVYPDWj18F2H_QK3y5h8MUa8gaQsiWv-c0xv7vzOfz0bw_dBbyDNvsIzhg7EK8pJyyxNJkVTJ--Xr_iLRerBYQA20SGibFRIhj1v-BF2eg0KOk0jA6THcxjlR9Dt5uI7DpRzuZ1R78vNo-84LtzXhfmj7NfFaMMbvSn3zwqk3TmkkdU6AkZ-Ze55Sm5LjydZ6HTPHjUej4D990YKt38ye0bw5jDhpsuidxIigQugRSej_p2rRXvvwPH_jvJ9NEWA_aQd2orhmXKQHRZ8YSV9i9z4PMs0ZQN33Tl9CcgNfK22RSg21TLF__DGrCdbEERbQH3HB-_dcj0hKMbrbngKobKYY3qUjYD7Oer7vwoZwNKOt1eUDMKghUFCwTGVagkju9jicbhRngzo4IdOx5bkMqciMsrHUUYU6P3TyPkIhvZ1NnVZ4KXHLVTqhPgIQFh4lJ3A6kx8qybBx6pgOfycpAPhxHULMAVkya6qvnEQYJviujJeDYgqr9WzNze1BFcE6h7I9Rdo81x5-d-gJXTovB0Ek5koNqf9MEgZe7ZMwSyrJbg59B94lK9rsAYmwosJuCREqC3aatmGfiHOJZGrbXOP5mqbkTAUV3GN9ZTm-LlaM4gEe3f4JFn3Y77jVH2QXTj7tDlvceSDhY2xPortIwn532G3aIR6Bnro0LDdvp7IdP4CfMx4kaWoMiEjNf6uCobyTMbain7PM5eWLLjeVbCMQWDDjcHgXcH3RbJAC9JprV1cz0VqnKBtLwTzdY3VdsD_KUF8nmuZ5hpbTW0935xGDDGgnS8OEqR1Fn9oFBcSt4oUXbCR58sQjqK0XHK6t8nMxYRNApsBsN6jcfGXin71MC8xNJu4iCMUSu0UQ9-7-GM2Ms8wQXDKmq10y1ZIqQKjjQ7EXgKp7ivFpf9z-wtfn-sH5Sf1UKTnOizDrhPuUyTBaKgITZQj-fMsIr-jsRQXzMiT5T-7-FHsSf_jwbYWcmj3JINzfJ2K55NKQvveQiEkVjnWgY1EjJOhuRJWXmODFJKIrQ334iIjJ7l9w8zBF8A2qauBfX9wxYE6FHWnnm7yyqxqFf_qVlxGU__bnT6hiwy_7YLg15vL8l0x1ivMXAQ5P7l2U_eg82qtIjQ9qjT9q-TSL7uvdee8yW7feU6KJu-1FYnUho_6S82Vg7PU9Zobl_6BzU8OBZnJnqdKWrRrDB0g0i-Ic_f1Fy3uPwxBUib4oFannAmG33uc6GigmT2ouM-ojgB_0000?></g></svg>